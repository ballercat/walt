# Project structure

```
src/
  - index.js --> the "compiler"
  - tokenizer/ --> reads strings returns tokens
  - parser/  --> reads tokens, returns ast
  - generator/ --> generates IR for emiter
  - emitter/ --> reads ast, returns Web Assembly binary encoding
    - section/ --> contains mini-emitters for wasm binary sections
  - utils/
    - stream.js --> basic string stream object used in token generation
    - token-stream.js --> object used to hold tokens generated by tokenizer
    - output-stream.js --> object used to hold binary and dissasembler data
dist/ --> build
docs/ --> .io site with Explorer/Playground
```

## Tokenizer

The Tokenizer class accepts a `Stream` as input and parses it into distinct language tokens.
For the most part tokenizer is rather stable. There might be a bug or two that need fixing.

## Parser

The most 'hot' area of the codebase. Responsible for generating the correct AST/IR that the emitter
can convert into binary. This is where the tokens from tokenizer become language features.

The parser currently generates both AST and IR in a single pass of the token stream. The AST _may_ be removed in the future.

### Generator

The generator understands the AST and is used by the Parser to generate the Intermediate Representation
needed by the emitter.

## Emitter

Pure function which takes the IR generated by the parsing process and converts it to binary. Uses
the `output-stream`. This is the land of Web Assembly spec. Everything in here conforms to the spec
and is solely responsible for matching IR to WASM opcodes. Different binary "sections" have their own
mini-emitters.

# Developing

## Requirements

* `node 8`

Node 8+ has native Web Assembly support and this project takes full advantage of that fact.

## Commands

### Tests

Almost every piece of the compiler is unit tested.

* `npm run tdd`
* `npm run tdd -- --watch`
* `npm run tdd -- --watch <spec_file_path>`

Do not confuse with `npm test`. The `npm test` command is used for CI integration and generates
full code coverage reports. You may still use it if you are interested in coverall report.

## Merge Requests

* `coverall` will block a MR if it has decreased coverage by 5%.
* There are no other rules. Above % may change.
* UI/Explorer changes may require a screenshot and or running demo.

## Build

If you'd like to see your changes reflected in the explorer page, run the `npm run build` command.


